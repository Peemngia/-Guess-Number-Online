<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>üëë Admin Panel</title>

<style>
*{box-sizing:border-box;font-family:sans-serif}
body{
  margin:0;
  min-height:100vh;
  background:radial-gradient(circle at top,#111,#000);
  display:flex;
  justify-content:center;
  align-items:center;
  color:white;
}
.card{
  width:95%;
  max-width:440px;
  background:rgba(255,255,255,0.06);
  padding:25px;
  border-radius:20px;
  box-shadow:0 0 30px #00ffff55;
  text-align:center;
}
h1{color:#00ffff;margin-top:0}
input,button{
  width:100%;
  padding:14px;
  margin-top:10px;
  border-radius:12px;
  border:none;
  font-size:16px;
}
button{
  font-weight:bold;
  cursor:pointer;
  position:relative;
  z-index:10;
}
.green{background:#00ff88;color:#000}
.red{background:#ff4444;color:#fff}
.blue{background:#00ffff;color:#000}
.gray{background:#666;color:#fff}
.box{
  background:#000;
  border-radius:10px;
  padding:10px;
  margin-top:10px;
  max-height:120px;
  overflow:auto;
  text-align:left;
  font-size:14px;
}
.status{margin-top:10px;font-size:14px;opacity:0.85}
.hidden{display:none}
</style>
</head>

<body>

<div class="card">

<h1>üëë ADMIN PANEL</h1>

<div id="login">
  <input id="adminPass" placeholder="‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô">
  <button class="blue" id="loginBtn">‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>
</div>

<div id="panel" class="hidden">

  <hr>
  <b>üë¢ ‡πÄ‡∏ï‡∏∞‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÇ‡∏•‡∏Å (Global Kick - ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏ß)</b>
  <input id="kickPlayerInput" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∞">
  <button class="red" id="kickPlayerBtn">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ & ‡πÄ‡∏ï‡∏∞‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</button>
  <div class="status" id="kickStatus"></div>
  
  <hr>
  <b>‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞</b>
  <input id="targetRoomInput" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£">
  <button class="blue" id="viewRoomBtn">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏´‡πâ‡∏≠‡∏á (‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö, Host, ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥)</button>
  <div id="roomDetails" class="box" style="height: auto; max-height: none;">‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏î "‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏´‡πâ‡∏≠‡∏á"</div>
  
  <hr>
  <input id="newAnswerInput" type="number" placeholder="‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà (1-100)">
  <button class="green" id="changeAnswerBtn">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô & ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏≠‡∏ö</button>
  
  <input id="playerToKickFromRoom" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏ï‡∏∞‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ">
  <button class="red" id="kickSpecificPlayerBtn">‡πÄ‡∏ï‡∏∞‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞</button>
  
  <button class="red" id="deleteRoomBtn">‚ùå ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏ñ‡∏≤‡∏ß‡∏£</button>
  
  <hr>

  <div class="status" id="timer">‚è≥ ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏µ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü...</div>
  <button class="green" id="onBtn">‡πÄ‡∏õ‡∏¥‡∏î Auto Reset</button>
  <button class="gray"  id="offBtn">‡∏õ‡∏¥‡∏î Auto Reset</button>
  <button class="red"   id="resetBtn">‡∏£‡∏µ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</button>

  <hr>

  <b>üë• ‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</b>
  <div class="box" id="rooms">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>

</div>

</div>

<audio id="clickSound" src="computer-mouse-click-352734.mp3" preload="auto"></audio> 

<script type="module">
import { initializeApp } from
"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, set, get, remove, onValue, update, push }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

/* üî• ‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢!) */
const ADMIN_PASSWORD = "1234";

/* üî• firebase config (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏°‡∏∂‡∏á‡πÄ‡∏≠‡∏á!) */
const firebaseConfig = {
  apiKey: "API_KEY_‡∏Ç‡∏≠‡∏á‡∏°‡∏∂‡∏á",
  authDomain: "PROJECT.firebaseapp.com",
  databaseURL: "https://PROJECT-default-rtdb.firebaseio.com",
  projectId: "PROJECT"
};

const app = initializeApp(firebaseConfig);
const db  = getDatabase(app);

// New DOM elements
const targetRoomInput = document.getElementById("targetRoomInput");
const kickPlayerInput = document.getElementById("kickPlayerInput");
const kickStatusDiv = document.getElementById("kickStatus");
const roomDetailsDiv = document.getElementById("roomDetails");
const newAnswerInput = document.getElementById("newAnswerInput");
const playerToKickFromRoom = document.getElementById("playerToKickFromRoom");

/* Sound Function */
function playClick() {
    const audio = document.getElementById("clickSound");
    audio.currentTime = 0;
    audio.play().catch(e => console.log("Sound play failed:", e)); 
}


/* ========================
   ‚öôÔ∏è ROOM MANAGEMENT FUNCTIONS
======================== */

// Helper: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡πâ‡∏≠‡∏á
async function checkRoom(roomKey) {
    const snap = await get(ref(db, "rooms/" + roomKey));
    return snap.exists() ? snap.val() : null;
}

// 1. ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏´‡πâ‡∏≠‡∏á (‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô)
async function getRoomDetails() {
    playClick();
    const roomKey = targetRoomInput.value.trim();
    if (!roomKey) return roomDetailsDiv.innerHTML = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á";

    roomDetailsDiv.innerHTML = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...";
    const roomData = await checkRoom(roomKey);

    if (!roomData) {
        return roomDetailsDiv.innerHTML = `‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡πâ‡∏≠‡∏á <b>${roomKey}</b>`;
    }
    
    const playersCount = roomData.players ? Object.keys(roomData.players).length : 0;
    const guessedCount = roomData.guessedNumbers ? Object.keys(roomData.guessedNumbers).length : 0;
    const guessedNumbersList = roomData.guessedNumbers ? Object.keys(roomData.guessedNumbers).join(', ') : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ';
    const winStats = roomData.winStats ? JSON.stringify(roomData.winStats, null, 2) : '‡πÑ‡∏°‡πà‡∏°‡∏µ';

    let html = `<div style="padding: 5px;"><b>‡∏´‡πâ‡∏≠‡∏á: ${roomKey}</b></div>`;
    html += `<div>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: üë§ ${playersCount} ‡∏Ñ‡∏ô</div>`;
    html += `<div>‡∏´‡∏±‡∏ß‡∏´‡πâ‡∏≠‡∏á: üëë ${roomData.host}</div>`;
    html += `<div style="color: #00ff88; font-weight: bold;">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô: ${roomData.answer}</div>`;
    html += `<div>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏≤‡πÅ‡∏•‡πâ‡∏ß (${guessedCount}): ${guessedNumbersList}</div>`;
    html += `<div>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ä‡∏ô‡∏∞: <pre style="margin: 0; white-space: pre-wrap; font-size: 12px;">${winStats}</pre></div>`;
    
    roomDetailsDiv.innerHTML = html;
}

// 2. ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á
async function deleteSpecificRoom() {
    playClick();
    const roomKey = targetRoomInput.value.trim();
    if (!roomKey) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á");
    if (!confirm(`‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ô‡∏∞‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á ${roomKey} ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ!`)) return;

    const roomData = await checkRoom(roomKey);
    if (!roomData) return alert(`‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡πâ‡∏≠‡∏á ${roomKey} ‡∏à‡∏∂‡∏á‡∏•‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ`);

    await remove(ref(db, "rooms/" + roomKey));
    alert(`‡∏´‡πâ‡∏≠‡∏á ${roomKey} ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß`);
    roomDetailsDiv.innerHTML = "‡∏´‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡∏•‡∏ö";
}

// 3. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏≠‡∏ö
async function setNewAnswer() {
    playClick();
    const roomKey = targetRoomInput.value.trim();
    const newAnswer = Number(newAnswerInput.value.trim());

    if (!roomKey) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á");
    if (!newAnswer || newAnswer < 1 || newAnswer > 100) return alert("‡πÉ‡∏™‡πà‡πÄ‡∏•‡∏Ç 1-100 ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å");
    if (!confirm(`‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ô‡∏∞‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á ${roomKey} ‡πÄ‡∏õ‡πá‡∏ô ${newAnswer}? ‡∏ô‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏≠‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢`)) return;

    const roomData = await checkRoom(roomKey);
    if (!roomData) return alert(`‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡πâ‡∏≠‡∏á ${roomKey}`);

    await update(ref(db, "rooms/" + roomKey), { 
        answer: newAnswer,
        score: null, 
        guessedNumbers: null 
    });
    push(ref(db, "rooms/" + roomKey + "/chat"), { n: "ADMIN", m: `‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô ${newAnswer} ‡πÅ‡∏•‡πâ‡∏ß! ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà!` });
    alert(`‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á ${roomKey} ‡πÄ‡∏õ‡πá‡∏ô ${newAnswer} ‡πÅ‡∏•‡πâ‡∏ß!`);
    getRoomDetails(); 
}

// 4. ‡πÄ‡∏ï‡∏∞‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞
async function kickPlayerFromSpecificRoom() {
    playClick();
    const roomKey = targetRoomInput.value.trim();
    const playerToKick = playerToKickFromRoom.value.trim();

    if (!roomKey || !playerToKick) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô");
    if (!confirm(`‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ô‡∏∞‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏ï‡∏∞‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô ${playerToKick} ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á ${roomKey}?`)) return;

    const playerRef = ref(db, `rooms/${roomKey}/players/${playerToKick}`);
    const snap = await get(playerRef);

    if (!snap.exists()) return alert(`‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô ${playerToKick} ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á ${roomKey}`);

    await remove(playerRef);
    // ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å playersOnline ‡∏î‡πâ‡∏ß‡∏¢
    await remove(ref(db, `playersOnline/${playerToKick}`));

    push(ref(db, "rooms/" + roomKey + "/chat"), { n: "ADMIN", m: `‡πÄ‡∏ï‡∏∞ ${playerToKick} ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß!` });
    alert(`‡πÄ‡∏ï‡∏∞ ${playerToKick} ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á ${roomKey} ‡πÅ‡∏•‡πâ‡∏ß`);
    getRoomDetails(); 
}


/* ========================
   üë¢ GLOBAL KICK FUNCTION (FAST Lookup)
======================== */
async function kickPlayerGlobal() {
    playClick();
    const playerName = kickPlayerInput.value.trim();
    kickStatusDiv.innerHTML = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡∏∞...";

    if (!playerName) {
        kickStatusDiv.innerHTML = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô";
        return;
    }

    try {
        // ‡πÉ‡∏ä‡πâ NEW FAST LOOKUP
        const playerOnlineRef = ref(db, "playersOnline/" + playerName);
        const onlineSnap = await get(playerOnlineRef);

        if (onlineSnap.exists()) {
            const { room: roomFound } = onlineSnap.val(); 

            // 1. ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
            await remove(ref(db, `rooms/${roomFound}/players/${playerName}`));
            
            // 2. ‡∏•‡∏ö‡∏î‡∏±‡∏ä‡∏ô‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
            await remove(playerOnlineRef);

            push(ref(db, "rooms/" + roomFound + "/chat"), { n: "ADMIN", m: `‡πÄ‡∏ï‡∏∞ ${playerName} ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß (Global Kick - Fast Mode)!` });
            kickStatusDiv.innerHTML = `‚úÖ ‡πÄ‡∏ï‡∏∞ <b>${playerName}</b> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á <b>${roomFound}</b> ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏ß!)`;
        } else {
            kickStatusDiv.innerHTML = `‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô <b>${playerName}</b> ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡πÉ‡∏î‡πÜ`;
        }

    } catch (error) {
        console.error("Firebase Error (Global Kick):", error);
        kickStatusDiv.innerHTML = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∞';
    }
}


/* üîê LOGIN */
document.getElementById("loginBtn").addEventListener("click", ()=>{
  playClick();
  if(adminPass.value !== ADMIN_PASSWORD){
    alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î‡πÑ‡∏≠‡πâ‡∏™‡∏±‡∏™");
    return;
  }
  document.getElementById("login").style.display = "none";
  document.getElementById("panel").classList.remove("hidden");
  roomDetailsDiv.innerHTML = '‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏î "‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏´‡πâ‡∏≠‡∏á"'; 
});

/* ‚è≥ ‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü */
onValue(ref(db,"lastReset"), snap=>{
  if(!snap.exists()) return;
  setInterval(()=>{
    const left = 30*60*1000 - (Date.now()-snap.val());
    document.getElementById("timer").innerText =
      left>0
      ? "‚è≥ ‡∏£‡∏µ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å "+Math.floor(left/1000)+" ‡∏ß‡∏¥"
      : "üí• ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü";
  },1000);
});

/* üë• ‡∏´‡πâ‡∏≠‡∏á‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå */
onValue(ref(db,"rooms"), snap=>{
  const box = document.getElementById("rooms");
  box.innerHTML="";
  if(!snap.exists()){
    box.innerHTML="‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á";
    return;
  }
  snap.forEach(r=>{
    const p = r.val().players
      ? Object.keys(r.val().players).length
      : 0;
    const h = r.val().host || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
    box.innerHTML += `<div>üì¶ ${r.key} (üë§ ${p} ‡∏Ñ‡∏ô) - üëë ${h}</div>`;
  });
});

/* üõ†Ô∏è ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏î‡∏¥‡∏° */
document.getElementById("onBtn")
  .addEventListener("click",()=>{
    playClick();
    set(ref(db,"autoReset"),true)
  });

document.getElementById("offBtn")
  .addEventListener("click",()=>{
    playClick();
    set(ref(db,"autoReset"),false)
  });

document.getElementById("resetBtn")
  .addEventListener("click",async ()=>{
    playClick();
    if(!confirm("‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ô‡∏∞ ‡∏à‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏£‡∏¥‡∏á? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ!")) return;
    
    // ‡∏•‡∏ö playerOnline index ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Full Reset
    await remove(ref(db,"playersOnline")); 

    await remove(ref(db,"rooms"));
    await set(ref(db,"lastReset"),Date.now());
    await set(ref(db,"warned"),false);
    alert("‡∏£‡∏µ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß");
  });

/* üõ†Ô∏è ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÉ‡∏´‡∏°‡πà */
document.getElementById("kickPlayerBtn").addEventListener("click", kickPlayerGlobal);
document.getElementById("viewRoomBtn").addEventListener("click", getRoomDetails);
document.getElementById("deleteRoomBtn").addEventListener("click", deleteSpecificRoom);
document.getElementById("changeAnswerBtn").addEventListener("click", setNewAnswer);
document.getElementById("kickSpecificPlayerBtn").addEventListener("click", kickPlayerFromSpecificRoom);

</script>

</body>
</html>